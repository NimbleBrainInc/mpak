# MTF Secret Detection Patterns (CQ-01)
# These patterns are used to detect embedded secrets in bundle code.
# Primary tooling: TruffleHog (--only-verified for high confidence)

version: "1.0"
description: "Secret detection patterns for MTF CQ-01 control"

# High-confidence patterns that should always block
critical:
  - id: aws-access-key
    name: AWS Access Key
    pattern: "AKIA[0-9A-Z]{16}"
    severity: critical
    description: AWS access key ID

  - id: aws-secret-key
    name: AWS Secret Access Key
    pattern: "[0-9a-zA-Z/+]{40}"
    context: "aws_secret|secret_access_key|AWS_SECRET"
    severity: critical
    description: AWS secret access key (requires context match)

  - id: github-token
    name: GitHub Token
    pattern: "gh[pousr]_[A-Za-z0-9_]{36,}"
    severity: critical
    description: GitHub personal access token or app token

  - id: github-fine-grained
    name: GitHub Fine-Grained Token
    pattern: "github_pat_[A-Za-z0-9_]{22,}"
    severity: critical
    description: GitHub fine-grained personal access token

  - id: openai-api-key
    name: OpenAI API Key
    pattern: "sk-[A-Za-z0-9]{48}"
    severity: critical
    description: OpenAI API key

  - id: anthropic-api-key
    name: Anthropic API Key
    pattern: "sk-ant-[A-Za-z0-9-]{95}"
    severity: critical
    description: Anthropic Claude API key

  - id: stripe-secret-key
    name: Stripe Secret Key
    pattern: "sk_live_[A-Za-z0-9]{24,}"
    severity: critical
    description: Stripe live secret key

  - id: stripe-restricted-key
    name: Stripe Restricted Key
    pattern: "rk_live_[A-Za-z0-9]{24,}"
    severity: critical
    description: Stripe live restricted key

  - id: slack-token
    name: Slack Token
    pattern: "xox[baprs]-[0-9]{10,13}-[0-9a-zA-Z]{24,}"
    severity: critical
    description: Slack OAuth or bot token

  - id: slack-webhook
    name: Slack Webhook URL
    pattern: 'https://hooks\.slack\.com/services/T[A-Z0-9]+/B[A-Z0-9]+/[A-Za-z0-9]+'
    severity: critical
    description: Slack incoming webhook URL

  - id: private-key
    name: Private Key
    pattern: "-----BEGIN (RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----"
    severity: critical
    description: PEM-encoded private key

  - id: google-api-key
    name: Google API Key
    pattern: 'AIza[0-9A-Za-z\\-_]{35}'
    severity: critical
    description: Google API key

  - id: google-oauth-client
    name: Google OAuth Client Secret
    pattern: "GOCSPX-[A-Za-z0-9-_]{28}"
    severity: critical
    description: Google OAuth 2.0 client secret

  - id: twilio-api-key
    name: Twilio API Key
    pattern: "SK[a-f0-9]{32}"
    severity: critical
    description: Twilio API key

  - id: sendgrid-api-key
    name: SendGrid API Key
    pattern: 'SG\.[A-Za-z0-9_-]{22}\.[A-Za-z0-9_-]{43}'
    severity: critical
    description: SendGrid API key

  - id: npm-token
    name: NPM Token
    pattern: "npm_[A-Za-z0-9]{36}"
    severity: critical
    description: NPM publish token

  - id: pypi-token
    name: PyPI Token
    pattern: "pypi-[A-Za-z0-9-_]{100,}"
    severity: critical
    description: PyPI API token

# High severity patterns (may have false positives without context)
high:
  - id: generic-api-key
    name: Generic API Key Assignment
    pattern: '(api[_-]?key|apikey)\s*[:=]\s*[''"][A-Za-z0-9]{20,}[''"]'
    severity: high
    description: Generic API key in code
    flags: case_insensitive

  - id: generic-secret
    name: Generic Secret Assignment
    pattern: '(secret|password|passwd|pwd)\s*[:=]\s*[''"][^''"]{8,}[''"]'
    severity: high
    description: Generic secret or password in code
    flags: case_insensitive

  - id: bearer-token
    name: Bearer Token
    pattern: 'Bearer\s+[A-Za-z0-9_-]{20,}'
    severity: high
    description: Authorization bearer token

  - id: jwt-token
    name: JWT Token
    pattern: 'eyJ[A-Za-z0-9_-]*\.eyJ[A-Za-z0-9_-]*\.[A-Za-z0-9_-]*'
    severity: high
    description: JSON Web Token

  - id: database-url
    name: Database Connection URL
    pattern: "(postgres|mysql|mongodb|redis)://[^:]+:[^@]+@"
    severity: high
    description: Database URL with embedded credentials

# Medium severity (common false positives, but worth flagging)
medium:
  - id: base64-secret
    name: Base64 Encoded Secret
    pattern: '(secret|key|token|password)\s*[:=]\s*[''"][A-Za-z0-9+/]{40,}={0,2}[''"]'
    severity: medium
    description: Possible base64-encoded secret
    flags: case_insensitive

  - id: hex-secret
    name: Hex-Encoded Secret
    pattern: '(secret|key)\s*[:=]\s*[''"][a-fA-F0-9]{32,}[''"]'
    severity: medium
    description: Possible hex-encoded secret

# Excluded patterns (common false positives)
exclusions:
  - pattern: "EXAMPLE|example|placeholder|your[_-]?(api)?[_-]?key|xxx|test|dummy|fake|sample"
    description: Placeholder or example values

  - pattern: '\.env\.example|\.env\.sample|README|documentation'
    description: Documentation files

  - pattern: "public[_-]?key|PUBLIC[_-]?KEY"
    description: Public keys (not secrets)
